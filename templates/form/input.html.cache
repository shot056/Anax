my $_buf = ""; my $_V;  $_buf .= q`<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>` . escape_xml( $name ) . q`</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->

    <link rel="stylesheet" href="` . escape_xml( $get_path->('/static/lightbox/css/lightbox.css') ) . q`">
    <link rel="stylesheet" href="` . escape_xml( $get_path->('/static/css/overcast/jquery-ui-1.11.2.min.css') ) . q`">
    <link rel="stylesheet" href="` . escape_xml( $get_path->('/static/css/overcast/jquery-ui-1.11.2.structure.min.css') ) . q`">
    <link rel="stylesheet" href="` . escape_xml( $get_path->('/static/css/overcast/jquery-ui-1.11.2.theme.min.css') ) . q`">
    <link href="` . escape_xml( $get_path->('/static/css/bootstrap.min.css') ) . q`" rel="stylesheet">
    <style type="text/css">
     body {
       padding-top: 40px;
       padding-bottom: 40px;
       background-color: #f5f5f5;
     }

     .form-input {
       max-width: 800px;
       padding: 19px 29px 29px;
       margin: 0 auto 20px;
       background-color: #fff;
       border: 1px solid #e5e5e5;
       -webkit-border-radius: 5px;
          -moz-border-radius: 5px;
               border-radius: 5px;
       -webkit-box-shadow: 0 1px 2px rgba(0,0,0,.05);
          -moz-box-shadow: 0 1px 2px rgba(0,0,0,.05);
               box-shadow: 0 1px 2px rgba(0,0,0,.05);
     }
     .form-input .form-signin-heading,
     .form-input .checkbox {
       margin-bottom: 10px;
     }
     .form-input input[type="text"],
     .form-input input[type="password"] {
       font-size: 16px;
       height: auto;
       margin-bottom: 15px;
       padding: 7px 9px;
     }
     .image-slides {
       display: none;
     }
     .one-product {
       width: 250px;
       float: left;
       margin: 5px;
       max-height: 272px;
     }
     .one-product label {
       bottom: 0px;
     }

    </style>
    <link href="` . escape_xml( $get_path->('/static/css/bootstrap-theme.min.css') ) . q`" rel="stylesheet">
    
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="shortcut icon" href="` . escape_xml( $get_path->('/static/ico/favicon.ico') ) . q`">

    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="` . escape_xml( $get_path->('/static/ico/apple-touch-icon-144-precomposed.png') ) . q`">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="` . escape_xml( $get_path->('/static/ico/apple-touch-icon-114-precomposed.png') ) . q`">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="` . escape_xml( $get_path->('/static/ico/apple-touch-icon-72-precomposed.png') ) . q`">
    <link rel="apple-touch-icon-precomposed" href="` . escape_xml( $get_path->('/static/ico/apple-touch-icon-57-precomposed.png') ) . q`">
  </head>

  <body>

    <div class="container">

      <form id="form1" class="form-input form-horizontal" method="POST" action="` . escape_xml( $get_path->($action_base, '/confirm') ) . q`" role="form">
        <h2 class="form-signin-heading">` . escape_xml( $name ) . q`</h2>
`;         if( length( $description ) ) {
 $_buf .= q`        <blockquote><p>` . ( $description ) . q`</p></blockquote>
`;         }
        if( length( $message ) ) {
 $_buf .= q`        <blockquote><p>` . ( $message ) . q`</p></blockquote>
`;         }
        if( $has_products ) {
 $_buf .= q`        <div class="form-group">
`;           if( length( $product_message ) ) {
 $_buf .= q`          <label class="col-sm-10">` . escape_xml( $product_message ) . q`</label>
`;           } 
 $_buf .= q`          <div id="products" class="col-sm-offset-2 col-sm-10">
`;           foreach my $p ( @{$product_list} ) {
 $_buf .= q`            <div class="one-product">
`;             if( $use_product_image ) {
              if( $p->{images}->{has_image} ) {
                  my $slide_st = 0;
                  if( $p->{images}->{has_thumb} ) {
 $_buf .= q`              <label><input type="checkbox" value="` . escape_xml( $p->{id} ) . q`" name="products"`; if( grep( $_ eq $p->{id}, @{ $params->{products} } ) ) { $_buf .= q` checked="checked"`; } $_buf .= q`>` . escape_xml( $p->{name} ) . q`</label>
              <div class="image-thumb">
                <a href="` . escape_xml( $p->{images}->{thumb}->{url} ) . q`" data-lightbox="prod-` . escape_xml( $p->{id} ) . q`" data-title="` . escape_xml( $p->{name} ) . q`">
                  <img src="` . escape_xml( $p->{images}->{thumb}->{thumb_url} ) . q`" alt="` . escape_xml( $p->{images}->{thumb}->{name} ) . q`" />
                </a>
              </div>
`;                   } else {
                  $slide_st = 1;
 $_buf .= q`              <input type="checkbox" value="` . escape_xml( $p->{id} ) . q`" name="products"`; if( grep( $_ eq $p->{id}, @{ $params->{products} } ) ) { $_buf .= q` checked="checked"`; } $_buf .= q`>
              <a href="` . escape_xml( $p->{images}->{slides}->[0]->{url} ) . q`" data-lightbox="prod-` . escape_xml( $p->{id} ) . q`" data-title="` . escape_xml( $p->{images}->{slides}->[0]->{name} ) . q`">` . escape_xml( $p->{name} ) . q`</a>
`;                   }
 $_buf .= q`              <div class="image-slides">
`;                   for( my $i = $slide_st; $i < scalar @{ $p->{images}->{slides} }; $i ++ ) {
 $_buf .= q`                <a href="` . escape_xml( $p->{images}->{slides}->[$i]->{url} ) . q`" data-lightbox="prod-` . escape_xml( $p->{id} ) . q`" data-title="` . escape_xml( $p->{images}->{slides}->[$i]->{name} ) . q`">` . escape_xml( $p->{name} ) . q`</a>
`;                   }
 $_buf .= q`              </div>
                
`;               } else {
 $_buf .= q`              <label><input type="checkbox" value="` . escape_xml( $p->{id} ) . q`" name="products"`; if( grep( $_ eq $p->{id}, @{ $params->{products} } ) ) { $_buf .= q` checked="checked"`; } $_buf .= q`>` . escape_xml( $p->{name} ) . q`</label>
`;               }
            } else {
 $_buf .= q`              <label><input type="checkbox" value="` . escape_xml( $p->{id} ) . q`" name="products"`; if( grep( $_ eq $p->{id}, @{ $params->{products} } ) ) { $_buf .= q` checked="checked"`; } $_buf .= q`>` . escape_xml( $p->{name} ) . q`</label>
`;             }
 $_buf .= q`            </div>
`;           }
 $_buf .= q`          </div>
        </div>
`;         }
        foreach my $f ( @{$field_list} ) {
 $_buf .= q`        <div class="form-group">
          <label class="col-sm-2 control-label" for="` . escape_xml( $f->{name} ) . q`">` . escape_xml( $f->{desc} ) . q`</label>
          <div class="col-sm-8">
            ` . ( $forms->{ $f->{name} } ) . q`
            <span class="help-inline">
`;               if( exists $messages->{ $f->{name} } ) {
 $_buf .= q`              <p class="text-danger">` . escape_xml( $messages->{ $f->{name} } ) . q`</p>
`;               }
 $_buf .= q`            </span>
          </div>
        </div>
`;         }
 $_buf .= q`        <div class="form-group">
          <div class="col-sm-offset-4 col-sm-4">
            <button id="btn-submit" class="btn btn-block btn-primary" type="submit">確認</button>
          </div>
        </div>
`;         if( $params->{is_admin} ) {
 $_buf .= q`        <input type="hidden" name="is_admin" value="1" />
`;         }
 $_buf .= q`      </form>

    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="` . escape_xml( $get_path->('/static/js/jquery-1.10.2.min.js') ) . q`"></script>
    <script src="` . escape_xml( $get_path->('/static/js/jquery-ui-1.11.2.min.js') ) . q`"></script>
    <script src="` . escape_xml( $get_path->('/static/lightbox/js/lightbox.js') ) . q`"></script>
    <script src="` . escape_xml( $get_path->('/static/js/bootstrap.min.js') ) . q`"></script>
    <script type="text/javascript" lang="javascript">
    $( document ).ready( function() {
      $("#form1").submit( function() {
        $("#btn-submit").attr("disabled","disabled");
        return true;
      } );
    } );
    </script>

  </body>

</html>
`;  $_buf;
